"use strict";var app=angular.module("app",["ui.router"]);app.config(["$httpProvider",function(e){e.defaults.transformRequest=function(e){var t=[];for(var o in e)t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},e.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded"}}]).run(["$rootScope","$state","$stateParams",function(e,t,o){e.$state=t,e.$stateParams=o}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/login"),e.state("login",{url:"/login",templateUrl:"transcript/login.html",controller:"LoginCtrl"}).state("achievement",{url:"/achievement",templateUrl:"transcript/achievement.html",controller:"AchievementCtrl",cache:!1})}]).controller("AppCtrl",["$scope",function(e){}]).controller("LoginCtrl",["$scope","$http","$state",function(e,t,o){function r(e){if(e&&8==e.length)return e=e.replace(/(.{4})/,"$1/"),e=e.replace(/(.{7})/,"$1/")}sessionStorage.getItem("tokenStudent")&&o.go("achievement"),e.app={name:"学生成绩查询"},e.user={},e.login=function(){e.user.name&&e.user.password?8!=e.user.password.length?e.authError="密码位数不正确~":(e.authError="",t({url:"api/Public/PhysicalFitnessTest/?service=User.checkLoginStudent",method:"post",data:{username:e.user.name,password:r(e.user.password)}}).success(function(t){0==t.data.code?(sessionStorage.setItem("tokenStudent",angular.toJson(t.data.info)),o.go("achievement")):e.authError="账号或密码错误~"}).error(function(t){e.authError=t})):e.authError="账号或密码不能为空~"}}]).controller("AchievementCtrl",["$scope","$filter","$state",function(e,t,o){sessionStorage.getItem("tokenStudent")||o.go("login"),e.logout=function(){sessionStorage.removeItem("tokenStudent"),o.go("login")},e.today=new Date,e.isTotalScoreSum=0;var r=angular.fromJson(sessionStorage.getItem("tokenStudent"));e.stu=r[0];for(var n=["41","42","43","44"],a=[],s=0;s<n.length;s++){var c=function(e){for(var t,o=0;o<r.length;o++){if(r[o].grade_num==e){t=r[o];break}t=!1}return t}(n[s]);c?a.push(c):(a.push({grade_num:n[s]}),e.isTotalScoreSum=1)}console.log(a),e.info=a,e.subjectArr=[{key:"lung",name:"肺活量(毫升)",coefficient:.15},{key:"50m",name:"50米跑(秒)",coefficient:.2},{key:"sr",name:"坐位体前屈(厘米)",coefficient:.1},{key:"jump",name:"立定跳远(厘米)",coefficient:.1}];var i=[{key:"pullup",name:"引体向上(男)/一分钟仰卧起坐(女)(次)",coefficient:.1},{key:"1000",name:"1000(男)/800(女)米跑(分•秒)",coefficient:.2}],u=[{key:"situp",name:"引体向上(男)/一分钟仰卧起坐(女)(次)",coefficient:.1},{key:"800",name:"1000(男)/800(女)米跑(分•秒)",coefficient:.2}];1==e.stu.sex||"男"==e.stu.sex?(e.subjectArr=e.subjectArr.concat(i),e.subjectAttachArr=i):(e.subjectArr=e.subjectArr.concat(u),e.subjectAttachArr=u),setTimeout(function(){for(var t=[],o=[],r=0,n=0;n<4;n++){for(var a=$(".4"+(n+1)),s=0,c=0,i=0,u=0;u<a.length;u++)s+=parseFloat(a.eq(u).html()*a.eq(u).attr("c"));t.push(s.toFixed(2)),e.standardScore=t;for(var l=$(".4"+(n+1)+"_attach"),m=0;m<l.length;m++)c+=parseFloat(l.eq(m).html());i=s+c,o.push(i.toFixed(2)),e.totalScore=o,0==e.isTotalScoreSum?(r+=n<3?i/6:i/2,e.totalScoreSum=r.toFixed(2)):e.totalScoreSum="",e.$apply()}},100)}]);