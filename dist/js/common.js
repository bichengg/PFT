"use strict";var app=angular.module("app",["ngAnimate","ngCookies","ngResource","ngStorage","ui.router","ui.bootstrap","ui.load","ui.jq","ui.validate","oc.lazyLoad"]);app.config(["$controllerProvider","$compileProvider","$filterProvider","$provide",function(e,t,a,r){app.controller=e.register,app.directive=t.directive,app.filter=a.register,app.factory=r.factory,app.service=r.service,app.constant=r.constant,app.value=r.value}]).config(["$httpProvider",function(e){e.defaults.transformRequest=function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},e.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded"}}]),app.constant("JQ_CONFIG",{easyPieChart:["vendor/jquery/charts/easypiechart/jquery.easy-pie-chart.js"],sparkline:["vendor/jquery/charts/sparkline/jquery.sparkline.min.js"],plot:["vendor/jquery/charts/flot/jquery.flot.min.js","vendor/jquery/charts/flot/jquery.flot.resize.js","vendor/jquery/charts/flot/jquery.flot.tooltip.min.js","vendor/jquery/charts/flot/jquery.flot.spline.js","vendor/jquery/charts/flot/jquery.flot.orderBars.js","vendor/jquery/charts/flot/jquery.flot.pie.min.js"],slimScroll:["../../lib/jquery-slimscroll/jquery.slimscroll.min.js"],sortable:["vendor/jquery/sortable/jquery.sortable.js"],nestable:["vendor/jquery/nestable/jquery.nestable.js","vendor/jquery/nestable/nestable.css"],filestyle:["vendor/jquery/file/bootstrap-filestyle.min.js"],slider:["vendor/jquery/slider/bootstrap-slider.js","vendor/jquery/slider/slider.css"],chosen:["vendor/jquery/chosen/chosen.jquery.min.js","vendor/jquery/chosen/chosen.css"],TouchSpin:["vendor/jquery/spinner/jquery.bootstrap-touchspin.min.js","vendor/jquery/spinner/jquery.bootstrap-touchspin.css"],wysiwyg:["vendor/jquery/wysiwyg/bootstrap-wysiwyg.js","vendor/jquery/wysiwyg/jquery.hotkeys.js"],dataTable:["vendor/jquery/datatables/jquery.dataTables.min.js","vendor/jquery/datatables/dataTables.bootstrap.js","vendor/jquery/datatables/dataTables.bootstrap.css"],vectorMap:["vendor/jquery/jvectormap/jquery-jvectormap.min.js","vendor/jquery/jvectormap/jquery-jvectormap-world-mill-en.js","vendor/jquery/jvectormap/jquery-jvectormap-us-aea-en.js","vendor/jquery/jvectormap/jquery-jvectormap.css"],footable:["vendor/jquery/footable/footable.all.min.js","vendor/jquery/footable/footable.core.css"]}).config(["$ocLazyLoadProvider",function(e){e.config({debug:!1,events:!0,modules:[{name:"ngGrid",files:["vendor/modules/ng-grid/ng-grid.min.js","vendor/modules/ng-grid/ng-grid.min.css","vendor/modules/ng-grid/theme.css"]},{name:"ui.select",files:["vendor/modules/angular-ui-select/select.min.js","vendor/modules/angular-ui-select/select.min.css"]},{name:"angularFileUpload",files:["vendor/modules/angular-file-upload/angular-file-upload.min.js"]},{name:"ui.calendar",files:["vendor/modules/angular-ui-calendar/calendar.js"]},{name:"ngImgCrop",files:["vendor/modules/ngImgCrop/ng-img-crop.js","vendor/modules/ngImgCrop/ng-img-crop.css"]},{name:"angularBootstrapNavTree",files:["libs/angular-bootstrap-nav-tree/abn_tree_directive.js","libs/angular-bootstrap-nav-tree/abn_tree.css"]},{name:"toaster",files:["libs/angularjs-toaster/toaster.js","libs/angularjs-toaster/toaster.css"]},{name:"textAngular",files:["vendor/modules/textAngular/textAngular-sanitize.min.js","vendor/modules/textAngular/textAngular.min.js"]},{name:"vr.directives.slider",files:["vendor/modules/angular-slider/angular-slider.min.js","vendor/modules/angular-slider/angular-slider.css"]},{name:"com.2fdevs.videogular",files:["vendor/modules/videogular/videogular.min.js"]},{name:"com.2fdevs.videogular.plugins.controls",files:["vendor/modules/videogular/plugins/controls.min.js"]},{name:"com.2fdevs.videogular.plugins.buffering",files:["vendor/modules/videogular/plugins/buffering.min.js"]},{name:"com.2fdevs.videogular.plugins.overlayplay",files:["vendor/modules/videogular/plugins/overlay-play.min.js"]},{name:"com.2fdevs.videogular.plugins.poster",files:["vendor/modules/videogular/plugins/poster.min.js"]},{name:"com.2fdevs.videogular.plugins.imaads",files:["vendor/modules/videogular/plugins/ima-ads.min.js"]},{name:"ngEcharts",files:["vendor/modules/ng-echarts/echarts.min.js"]},{name:"ngAmap",files:["vendor/modules/ng-amap/amap.js","http://webapi.amap.com/maps?v=1.3&key=471ac3e24922c1ef15c0f61fdd0af0e1"]}]})}]),app.run(["$rootScope","$state","$stateParams",function(e,t,a){e.$state=t,e.$stateParams=a}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/login"),e.state("login",{url:"/login",templateUrl:"tpl/login.html",controller:"LoginCtrl",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["src/js/controllers/login.js"])}]}}).state("app",{abstract:!0,url:"/app",templateUrl:"tpl/app.html",resolve:{deps:["$ocLazyLoad",function(e){return e.load("toaster")}]}}).state("app.manage",{abstract:!0,url:"/manage",template:'<div ui-view class="fade-in-left h-full"></div>'}).state("app.manage.teacher",{url:"/teacher",templateUrl:"tpl/manage/teacher/list.html",controller:"TeacherCtrl",cache:!1,resolve:{deps:["$ocLazyLoad",function(e){return e.load(["src/js/controllers/app/manage/teacher.js"])}]}}).state("app.manage.student",{url:"/student",templateUrl:"tpl/manage/student/list.html",controller:"StudentCtrl",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["src/js/controllers/app/manage/student.js"])}]}}).state("app.manage.allot",{url:"/allot",templateUrl:"tpl/manage/allot/list.html",controller:"AllotCtrl",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["src/js/controllers/app/manage/allot.js"])}]}}).state("app.manage.score",{url:"/score",templateUrl:"tpl/manage/score/list.html",controller:"ScoreCtrl",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["src/js/controllers/app/manage/score.js"])}]}}).state("app.manage.progress",{url:"/progress",templateUrl:"tpl/manage/progress/list.html",controller:"ProgressCtrl",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["src/js/controllers/app/manage/progress.js"])}]}}).state("app.manage.subject",{url:"/subject",templateUrl:"tpl/manage/subject/list.html",controller:"SubjectCtrl",cache:!1,resolve:{deps:["$ocLazyLoad",function(e){return e.load(["src/js/controllers/app/manage/subject.js"])}]}}).state("app.teacher",{abstract:!0,url:"/teacher",template:'<div ui-view class="fade-in-left h-full"></div>'}).state("app.teacher.list",{url:"/list",templateUrl:"tpl/teacher/list.html",controller:"Teacher2stuCtrl",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["src/js/controllers/app/teacher/teacher.js"])}]}})}]),app.filter("trans2statusText",function(){return function(e){var t="";switch(e){case"1":t="病假";break;case"2":t="事假";break;case"3":t="未参加";break;default:t="无"}return t}}).constant("APP",{name:"学生体测管理",version:"1.0.0",nav:[],baseurl:"api/Public/PhysicalFitnessTest/",token:sessionStorage.getItem("token"),settings:{themeID:1,navbarHeaderColor:"bg-black",navbarCollapseColor:"bg-white-only",asideColor:"bg-black",headerFixed:!0,asideFixed:!0,asideFolded:!1,asideDock:!1,container:!1},hideAside:!1,hideFooter:!0}).controller("AppCtrl",["APP","$scope","Subject","$q","$http","$state","$filter",function(e,t,a,r,n,o,s){t.app=e;var i=new Date;t.student={year:i.getFullYear(),years:[],status:0,statusList:[{key:"全部",val:""},{key:"有成绩",val:0},{key:"有备注",val:-1},{key:"无老师",val:-2}],size:0,pages:2e4,maxSize:6,current:1,json:[],jsonReady:!0,resJson:[]};for(var l=0;l<5;l++)t.student.years.push(t.student.year-l);t.getScroeList=function(){var e=r.defer(),n=e.promise;return a.getList().then(function(a){t.resSubjectList=a.data.info,e.resolve(a)}),n},t.getStudentList=function(a){var a=a||"",o=r.defer(),s=o.promise;return n({method:"get",url:e.baseurl+"?service=Student.getInfo",params:{token:e.token,year:t.student.year,status:t.student.status,size:t.student.size,current:t.student.current,student_code:a}}).success(function(e){o.resolve(e),e.data&&(t.student.resJson=e.data.info)}).error(function(e){o.reject(e),console.log(e)}),s},t.importf=function(e){var a;if(e.files){var r=e.files[0],n=new FileReader;n.onload=function(e){var r=e.target.result;a=XLSX.read(r,{type:"binary"}),t.student.json=XLSX.utils.sheet_to_json(a.Sheets[a.SheetNames[0]]),t.student.jsonReady=!1,t.$apply()},n.readAsBinaryString(r)}},t.downloadExl=function(e,r){function n(e){for(var t="",a=0;e>0;)a=e%26+1,t=String.fromCharCode(a+64)+t,e=(e-a)/26;return t}var o,i=angular.copy(t.student.resJson),l=i[0];i.unshift({});var u=[],c=angular.copy(t.resSubjectList);for(var d in l)if("id"!=d&&"teacherId"!=d&&"teacher_id"!=d&&"time"!=d&&"create_time"!=d&&"school_year"!=d&&"is_submit"!=d&&"address"!=d&&"born"!=d&&"nation"!=d&&"grade_num"!=d&&"class_num"!=d)if(1==e&&"id_card"!=d&&"teacherName"!=d){var p="";switch(d){case"grade_num":p="年级编号";break;case"class_num":p="班级编号";break;case"class_name":p="班级名称";break;case"student_code":p="学籍号";break;case"nation":p="民族代码";break;case"name":p="姓名";break;case"sex":p="性别";break;case"born":p="出生日期";break;case"teacher_class":p="课程名称";break;case"address":p="家庭住址";break;case"status":p="备注";break;default:p=a.transCn(d,c)}u.push(d),i[0][d]=p}else if(2==e&&"teacher_class"!=d){var p="";switch(d){case"grade_num":p="年级编号";break;case"class_num":p="班级编号";break;case"class_name":p="班级名称";break;case"student_code":p="学籍号";break;case"nation":p="民族代码";break;case"name":p="姓名";break;case"sex":p="性别";break;case"born":p="出生日期";break;case"id_card":p="身份证号码";break;case"address":p="家庭住址";break;case"status":p="备注";break;case"teacherName":p="教师姓名";break;default:p=a.transCn(d,c)}u.push(d),i[0][d]=p}var l=[],f={style:"thin",color:{rgb:"33333333"}};i.map(function(e,t){return t>0&&(e.status=s("trans2statusText")(e.status.toString())),u.map(function(a,r){return Object.assign({},{v:e[a],position:(r>25?n(r):String.fromCharCode(65+r))+(t+1)})})}).reduce(function(e,t){return e.concat(t)}).forEach(function(e,t){return l[e.position]={v:e.v,s:{border:{top:f,bottom:f,left:f,right:f}}}});var m=Object.keys(l);l["!cols"]=[{wpx:70},{wpx:85}];var g={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},l,{"!ref":m[0]+":"+m[m.length-1]})}};o=new Blob([function(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),r=0;r!=e.length;++r)a[r]=255&e.charCodeAt(r);return t}(XLSX.write(g,{bookType:void 0==r?"xlsx":r,bookSST:!1,type:"binary"}))],{type:""});var v=URL.createObjectURL(o);document.getElementById("hf").href=v,document.getElementById("hf").click(),setTimeout(function(){URL.revokeObjectURL(o)},100)},t.nav=[{key:"manage",name:"管理平台",icon:"fa-cubes",child:[{key:"teacher",name:"教师管理"},{key:"student",name:"任务导入"},{key:"allot",name:"任务分配"},{key:"progress",name:"进度查询"},{key:"score",name:"全校成绩导出"},{key:"subject",name:"体测项目管理"}]}],t.logout=function(){localStorage.removeItem("teacher"),sessionStorage.removeItem("token"),e.token="",location.href="admins.html"}}]),app.service("Subject",["APP","$http","$q",function(e,t,a){this.transCn=function(e,t){for(var a="",r=0;r<t.length;r++)t[r].column_name==e&&(a=t[r].column_comment);return a},this.transEn=function(e,t){for(var a="",r=0;r<t.length;r++)t[r].column_comment==e&&(a=t[r].column_name);return a},this.getList=function(){var r=a.defer(),n=r.promise;return t({method:"get",url:e.baseurl+"?service=Subject.getInfo",params:{token:e.token}}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),n}}]),angular.module("ui.load",[]).service("uiLoad",["$document","$q","$timeout",function(e,t,a){var r=[],n=!1,o=t.defer();this.load=function(e){e=angular.isArray(e)?e:e.split(/\s+/);var t=this;return n||(n=o.promise),angular.forEach(e,function(e){n=n.then(function(){return e.indexOf(".css")>=0?t.loadCSS(e):t.loadScript(e)})}),o.resolve(),n},this.loadScript=function(n){if(r[n])return r[n].promise;var o=t.defer(),s=e[0].createElement("script");return s.src=n,s.onload=function(e){a(function(){o.resolve(e)})},s.onerror=function(e){a(function(){o.reject(e)})},e[0].body.appendChild(s),r[n]=o,o.promise},this.loadCSS=function(n){if(r[n])return r[n].promise;var o=t.defer(),s=e[0].createElement("link");return s.rel="stylesheet",s.type="text/css",s.href=n,s.onload=function(e){a(function(){o.resolve(e)})},s.onerror=function(e){a(function(){o.reject(e)})},e[0].head.appendChild(s),r[n]=o,o.promise}}]),angular.module("app").directive("setNgAnimate",["$animate",function(e){return{link:function(t,a,r){t.$watch(function(){return t.$eval(r.setNgAnimate,t)},function(t,r){e.enabled(!!t,a)})}}}]),angular.module("app").directive("uiButterbar",["$rootScope","$anchorScroll",function(e,t){return{restrict:"AC",template:'<span class="bar"></span>',link:function(e,a,r){a.addClass("butterbar hide"),e.$on("$stateChangeStart",function(e){t(),a.removeClass("hide").addClass("active")}),e.$on("$stateChangeSuccess",function(e,t,r,n){e.targetScope.$watch("$viewContentLoaded",function(){a.addClass("hide").removeClass("active")})})}}}]),angular.module("app").directive("uiFocus",function(e,t){return{link:function(a,r,n){var o=t(n.uiFocus);a.$watch(o,function(t){!0===t&&e(function(){r[0].focus()})}),r.bind("blur",function(){a.$apply(o.assign(a,!1))})}}}),angular.module("app").directive("uiFullscreen",["uiLoad","$document","$window",function(e,t,a){return{restrict:"AC",template:'<i class="fa fa-expand fa-fw text"></i><i class="fa fa-compress fa-fw text-active"></i>',link:function(a,r,n){r.addClass("hide"),e.load("../../lib/screenfull/screenfull.min.js").then(function(){screenfull.enabled&&!navigator.userAgent.match(/Trident.*rv:11\./)&&r.removeClass("hide"),r.on("click",function(){var e;n.target&&(e=$(n.target)[0]),screenfull.toggle(e)}),t.on(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?r.addClass("active"):r.removeClass("active")})})}}}]),angular.module("ui.jq",["ui.load"]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","JQ_CONFIG","uiLoad","$timeout",function(e,t,a,r){return{restrict:"A",compile:function(n,o){if(!angular.isFunction(n[o.uiJq])&&!t[o.uiJq])throw new Error('ui-jq: The "'+o.uiJq+'" function does not exist');var s=e&&e[o.uiJq];return function(e,n,o){function i(){var t=[];return o.uiOptions?(t=e.$eval("["+o.uiOptions+"]"),angular.isObject(s)&&angular.isObject(t[0])&&(t[0]=angular.extend({},s,t[0]))):s&&(t=[s]),t}function l(){r(function(){n[o.uiJq].apply(n,i())},0,!1)}function u(){o.uiRefresh&&e.$watch(o.uiRefresh,function(){l()})}o.ngModel&&n.is("select,input,textarea")&&n.bind("change",function(){n.trigger("input")}),t[o.uiJq]?a.load(t[o.uiJq]).then(function(){l(),u()}).catch(function(){}):(l(),u())}}}}]),angular.module("app").directive("uiModule",["MODULE_CONFIG","uiLoad","$compile",function(e,t,a){return{restrict:"A",compile:function(r,n){var o=r.contents().clone();return function(r,n,s){n.contents().remove(),t.load(e[s.uiModule]).then(function(){a(o)(r,function(e,t){n.append(e)})})}}}}]),angular.module("app").directive("uiNav",["$timeout",function(e){return{restrict:"AC",link:function(e,t,a){var r,n=$(window),o=$(".app-aside");t.on("click","a",function(e){r&&r.trigger("mouseleave.nav");var t=$(this);t.parent().siblings(".active").toggleClass("active"),t.next().is("ul")&&t.parent().toggleClass("active")&&e.preventDefault(),t.next().is("ul")||n.width()<768&&$(".app-aside").removeClass("show off-screen")}),t.on("mouseenter","a",function(e){if(r&&r.trigger("mouseleave.nav"),$("> .nav",o).remove(),!(!$(".app-aside-fixed.app-aside-folded").length||n.width()<768||$(".app-aside-dock").length)){var t,a=$(e.target),s=$(window).height();!a.is("a")&&(a=a.closest("a")),a.next().is("ul")&&(r=a.next(),a.parent().addClass("active"),t=a.parent().position().top+50,r.css("top",t),t+r.height()>s&&r.css("bottom",0),t+150>s&&r.css("bottom",s-t-50).css("top","auto"),r.appendTo(o),r.on("mouseleave.nav",function(e){$(".dropdown-backdrop").remove(),r.appendTo(a.parent()),r.off("mouseleave.nav").css("top","auto").css("bottom","auto"),a.parent().removeClass("active")}),$(".smart").length&&$('<div class="dropdown-backdrop"/>').insertAfter(".app-aside").on("click",function(e){e&&e.trigger("mouseleave.nav")}))}}),o.on("mouseleave",function(e){r&&r.trigger("mouseleave.nav"),$("> .nav",o).remove()})}}}]),angular.module("app").directive("uiScroll",["$location","$anchorScroll",function(e,t){return{restrict:"AC",link:function(a,r,n){r.on("click",function(a){e.hash(n.uiScroll),t()})}}}]),angular.module("app").directive("uiShift",["$timeout",function(e){return{restrict:"A",link:function(t,a,r){function n(){e(function(){var e=r.uiShift,t=r.target;i.hasClass("in")||i[e](t).addClass("in")})}function o(){s&&s.prepend(a),!s&&i.insertAfter(u),i.removeClass("in")}var s,i=$(a),l=$(window),u=i.prev(),c=l.width();!u.length&&(s=i.parent()),c<768&&n()||o(),l.resize(function(){c!==l.width()&&e(function(){l.width()<768&&n()||o(),c=l.width()})})}}}]),angular.module("app").directive("uiToggleClass",["$timeout","$document",function(e,t){return{restrict:"AC",link:function(e,t,a){t.on("click",function(e){function r(e,t){for(var a=new RegExp("\\s"+e.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g"),r=" "+$(t)[0].className+" ";a.test(r);)r=r.replace(a," ");$(t)[0].className=$.trim(r)}e.preventDefault();var n=a.uiToggleClass.split(","),o=a.target&&a.target.split(",")||Array(t),s=0;angular.forEach(n,function(e){var t=o[o.length&&s];-1!==e.indexOf("*")&&r(e,t),$(t).toggleClass(e),s++}),$(t).toggleClass("active")})}}}]),angular.module("ui.validate",[]).directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,r){var n,o={},s=e.$eval(a.uiValidate);s&&(angular.isString(s)&&(s={validator:s}),angular.forEach(s,function(t,a){n=function(n){var o=e.$eval(t,{$value:n});return angular.isObject(o)&&angular.isFunction(o.then)?(o.then(function(){r.$setValidity(a,!0)},function(){r.$setValidity(a,!1)}),n):o?(r.$setValidity(a,!0),n):(r.$setValidity(a,!1),n)},o[a]=n,r.$formatters.push(n),r.$parsers.push(n)}),a.uiValidateWatch&&function(t){angular.isString(t)?e.$watch(t,function(){angular.forEach(o,function(e){e(r.$modelValue)})}):angular.isArray(t)?angular.forEach(t,function(t){e.$watch(t,function(){angular.forEach(o,function(e){e(r.$modelValue)})})}):angular.isObject(t)&&angular.forEach(t,function(t,a){angular.isString(t)&&e.$watch(t,function(){o[a](r.$modelValue)}),angular.isArray(t)&&angular.forEach(t,function(t){e.$watch(t,function(){o[a](r.$modelValue)})})})}(e.$eval(a.uiValidateWatch)))}}});